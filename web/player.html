<!DOCTYPE html>
<html>
<head>
    <title>{video_title}</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            overflow: hidden;
        }
        .video-container {
            position: relative;
            width: 100%;
            height: 100vh;
        }
        .video-js {
            width: 100%;
            height: 100%;
        }
        .vjs-control-bar {
            background: linear-gradient(to top, rgba(0,0,0,0.9), rgba(0,0,0,0.7));
        }
        .overlay-filename {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #fff;
            background: rgba(0,0,0,0.7);
            padding: 5px 10px;
            border-radius: 3px;
            font-family: Arial, sans-serif;
            z-index: 1000;
        }
        .subtitle-overlay {
            position: absolute;
            bottom: 60px;
            left: 10px;
            right: 10px;
            color: #fff;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 3px;
            font-family: Arial, sans-serif;
            font-size: 18px;
            text-align: center;
            z-index: 1000;
            text-shadow: 1px 1px 2px #000;
        }
        .settings-button {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            cursor: pointer;
            padding: 5px;
            background: rgba(0,0,0,0.7);
            border-radius: 3px;
        }
        .settings-menu {
            display: none;
            position: absolute;
            top: 40px;
            right: 10px;
            background: rgba(0,0,0,0.9);
            color: #fff;
            padding: 10px;
            border-radius: 5px;
            z-index: 1001;
            min-width: 200px;
        }
        .settings-menu.show {
            display: block;
        }
        .settings-item {
            padding: 5px 0;
            cursor: pointer;
        }
        .settings-item:hover {
            background: #ff416c;
        }
        .settings-item select {
            width: 100%;
            background: #333;
            color: #fff;
            border: none;
            padding: 5px;
        }
    </style>
</head>
<body>
    <div class="video-container">
        <video id="video-player" class="video-js" controls preload="metadata">
            <source src="{hls_path}" type="application/x-mpegURL">
        </video>
        <div class="overlay-filename">{filename}</div>
        <div class="subtitle-overlay" id="subtitle-overlay"></div>
        <div class="settings-button" onclick="toggleSettings()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="#fff">
                <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.43-.48-.43h-3.84c-.24 0-.43.19-.47.43l-.36 2.54c-.59.24-1.13.56-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.3-.06.62-.06.94s.02.64.06.94l-2.03 1.58c-.18.14-.23.41-.12-.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.43.48.43h3.84c.24 0 .44-.19.47-.43l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
            </svg>
        </div>
        <div class="settings-menu" id="settings-menu">
            <div class="settings-item">
                <label>Audio Track:</label>
                <select id="audio-tracks"></select>
            </div>
            <div class="settings-item">
                <label>Subtitles:</label>
                <select id="subtitle-tracks">
                    <option value="off">Off</option>
                </select>
            </div>
            <div class="settings-item">
                <label>Playback Speed:</label>
                <select id="playback-speed">
                    <option value="0.5">0.5x</option>
                    <option value="0.75">0.75x</option>
                    <option value="1" selected>1x</option>
                    <option value="1.25">1.25x</option>
                    <option value="1.5">1.5x</option>
                    <option value="2">2x</option>
                </select>
            </div>
            <div class="settings-item">
                <label>Quality:</label>
                <select id="quality-select">
                    <option value="auto" selected>Auto</option>
                </select>
            </div>
        </div>
    </div>
    <script>
        const player = videojs('video-player', {
            fluid: true,
            responsive: true,
            autoplay: {should_autoplay},
            muted: {should_autoplay},
            html5: {
                hls: {
                    enableLowInitialPlaylist: true,
                    overrideNative: true
                }
            },
            controlBar: {
                volumePanel: { inline: true },
                fullscreenToggle: true,
                pictureInPictureToggle: true
            }
        });

        player.ready(function() {
            if ({should_autoplay}) {
                player.play().catch(function(err) {
                    console.log('Autoplay failed:', err);
                });
            }

            // Audio Tracks
            const audioTracks = player.audioTracks();
            const audioSelect = document.getElementById('audio-tracks');
            if (audioTracks && audioTracks.length > 0) {
                for (let i = 0; i < audioTracks.length; i++) {
                    const track = audioTracks[i];
                    const option = document.createElement('option');
                    option.value = track.id;
                    option.text = track.label || `Track ${i + 1}`;
                    if (track.enabled) option.selected = true;
                    audioSelect.appendChild(option);
                }
                audioSelect.onchange = function() {
                    const currentTracks = player.audioTracks();
                    for (let j = 0; j < currentTracks.length; j++) {
                        currentTracks[j].enabled = currentTracks[j].id === this.value;
                    }
                };
                audioTracks.on('change', function() {
                    const currentTracks = player.audioTracks();
                    const activeTrack = Array.from(currentTracks).find(t => t.enabled);
                    audioSelect.value = activeTrack ? activeTrack.id : '';
                });
            }

            // Subtitles (VTT support)
            const textTracks = player.textTracks();
            const subtitleSelect = document.getElementById('subtitle-tracks');
            const subtitleOverlay = document.getElementById('subtitle-overlay');
            if (textTracks && textTracks.length > 0) {
                const setupSubtitleTrack = (track) => {
                    if (track.kind === 'subtitles' || track.kind === 'captions') {
                        const option = document.createElement('option');
                        option.value = track.label;
                        option.text = track.label || `Subtitle ${textTracks.length}`;
                        subtitleSelect.appendChild(option);

                        track.addEventListener('cuechange', function() {
                            const currentTracks = player.textTracks();
                            const activeTrack = Array.from(currentTracks).find(t => t.mode === 'showing');
                            subtitleOverlay.textContent = activeTrack && activeTrack.activeCues && activeTrack.activeCues.length > 0
                                ? activeTrack.activeCues[0].text
                                : '';
                        });
                    }
                };
                for (let i = 0; i < textTracks.length; i++) {
                    setupSubtitleTrack(textTracks[i]);
                }
                subtitleSelect.onchange = function() {
                    const currentTracks = player.textTracks();
                    for (let j = 0; j < currentTracks.length; j++) {
                        currentTracks[j].mode = (this.value === 'off' || currentTracks[j].label !== this.value) ? 'disabled' : 'showing';
                    }
                };
            }

            // Playback Speed
            const playbackSpeedSelect = document.getElementById('playback-speed');
            playbackSpeedSelect.onchange = function() {
                player.playbackRate(parseFloat(this.value));
            };

            // Quality
            const qualitySelect = document.getElementById('quality-select');
            player.on('loadedmetadata', function() {
                const levels = player.qualityLevels && player.qualityLevels();
                if (levels && levels.length > 0) {
                    for (let i = 0; i < levels.length; i++) {
                        const option = document.createElement('option');
                        option.value = levels[i].height + 'p';
                        option.text = levels[i].height + 'p';
                        qualitySelect.appendChild(option);
                    }
                    qualitySelect.onchange = function() {
                        const currentLevels = player.qualityLevels();
                        const height = this.value === 'auto' ? null : parseInt(this.value);
                        for (let j = 0; j < currentLevels.length; j++) {
                            currentLevels[j].enabled = height === null || currentLevels[j].height === height;
                        }
                    };
                    levels.on('change', function() {
                        const currentLevels = player.qualityLevels();
                        const selectedIndex = currentLevels.selectedIndex;
                        qualitySelect.value = selectedIndex === -1 ? 'auto' : currentLevels[selectedIndex].height + 'p';
                    });
                }
            });
        });

        function toggleSettings() {
            const menu = document.getElementById('settings-menu');
            menu.classList.toggle('show');
        }

        player.on('error', function() {
            player.errorDisplay.open();
        });
    </script>
</body>
</html>