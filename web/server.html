<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Stats - Media MeHub</title>
    <link rel="shortcut icon" type="image/x-icon" href="https://mehub.in/logo.ico" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
        }

        body {
            background: #000;
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            animation: fadeIn 1s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .app-bar {
            position: fixed;
            top: 0;
            width: 100%;
            height: 60px;
            background: rgba(20, 20, 20, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            padding: 0 20px;
            z-index: 1000;
        }

        .logo {
            width: 40px;
            height: 40px;
            background: url('https://mehub.in/logo.ico') no-repeat center;
            background-size: cover;
            margin-right: 15px;
        }

        .app-bar h1 {
            font-size: 24px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .menu-btn {
            display: none;
            font-size: 24px;
            cursor: pointer;
            margin-left: auto;
        }

        .sidebar {
            position: fixed;
            top: 60px;
            left: 0;
            width: 250px;
            height: calc(100% - 60px);
            background: rgba(30, 30, 30, 0.95);
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }

        .sidebar.active {
            transform: translateX(0);
        }

        .sidebar ul {
            list-style: none;
            padding: 20px;
        }

        .sidebar li {
            margin: 20px 0;
        }

        .sidebar a {
            color: #fff;
            text-decoration: none;
            font-size: 18px;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .sidebar a:hover {
            opacity: 1;
        }

        .content {
            margin-left: 0;
            padding: 80px 20px 20px;
            transition: margin-left 0.3s ease;
            max-width: 1200px;
            margin: 80px auto 20px;
        }

        .content.shifted {
            margin-left: 250px;
        }

        .overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(40, 40, 40, 0.8);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.5s ease;
        }

        .stat-card h3 {
            font-size: 16px;
            color: #ccc;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 24px;
            font-weight: 600;
            color: #fff;
            display: block;
            margin-bottom: 5px;
        }

        .stat-card .unit {
            font-size: 14px;
            color: #999;
        }

        .stat-card .details {
            font-size: 12px;
            color: #bbb;
            margin-top: 5px;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .graph-container {
            background: rgba(40, 40, 40, 0.8);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            height: 350px;
            display: flex;
            flex-direction: column;
        }

        canvas {
            width: 100% !important;
            height: 100% !important;
        }

        h2 {
            font-size: 20px;
            margin-bottom: 15px;
            color: #f5f5f5;
            letter-spacing: 0.3px;
        }

        @media (max-width: 768px) {
            .grid-container {
                grid-template-columns: 1fr;
            }

            .sidebar {
                width: 200px;
            }

            .content.shifted {
                margin-left: 200px;
            }

            .menu-btn {
                display: block;
            }

            .app-bar h1 {
                font-size: 20px;
            }

            .graph-container {
                height: 300px;
            }
        }

        @media (max-width: 480px) {
            .sidebar {
                width: 100%;
            }

            .content.shifted {
                margin-left: 0;
            }

            .graph-container {
                height: 250px;
            }

            .overview {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-bar">
        <div class="logo"></div>
        <h1>Server Stats</h1>
        <span class="menu-btn" onclick="toggleSidebar()">â˜°</span>
    </div>

    <div class="sidebar" id="sidebar">
        <ul>
            <li><a href="#">Dashboard</a></li>
            <li><a href="#">Videos</a></li>
            <li><a href="#">Settings</a></li>
            <li><a href="#">Logout</a></li>
        </ul>
    </div>

    <div class="content" id="content">
        <div class="overview">
            <div class="stat-card">
                <h3>CPU Usage</h3>
                <span class="value" id="cpuValue">0</span><span class="unit">%</span>
                <span class="details" id="cpuDetails">0 CPUs @ 0 GHz</span>
            </div>
            <div class="stat-card">
                <h3>RAM Usage</h3>
                <span class="value" id="ramValue">0 / 0</span><span class="unit">GB</span>
                <span class="details" id="ramDetails">0% Used</span>
            </div>
            <div class="stat-card">
                <h3>Disk Usage</h3>
                <span class="value" id="diskValue">0 / 0</span><span class="unit">GB</span>
                <span class="details" id="diskDetails">0% Used</span>
            </div>
            <div class="stat-card">
                <h3>Bandwidth Sent</h3>
                <span class="value" id="bandwidthSentValue">0</span><span class="unit">MB</span>
                <span class="details" id="bandwidthSentDetails">Total: 0 MB</span>
            </div>
            <div class="stat-card">
                <h3>Bandwidth Received</h3>
                <span class="value" id="bandwidthRecvValue">0</span><span class="unit">MB</span>
                <span class="details" id="bandwidthRecvDetails">Total: 0 MB</span>
            </div>
            <div class="stat-card">
                <h3>Uptime</h3>
                <span class="value" id="uptimeValue">0d 0h 0m 0s</span>
                <span class="details">Since Last Boot</span>
            </div>
        </div>

        <div class="grid-container">
            <div class="graph-container">
                <h2>CPU Usage (%)</h2>
                <canvas id="cpuChart"></canvas>
            </div>
            <div class="graph-container">
                <h2>RAM Usage (%)</h2>
                <canvas id="ramChart"></canvas>
            </div>
            <div class="graph-container">
                <h2>Disk Usage (%)</h2>
                <canvas id="diskChart"></canvas>
            </div>
            <div class="graph-container">
                <h2>Bandwidth Sent (MB)</h2>
                <canvas id="bandwidthSentChart"></canvas>
            </div>
            <div class="graph-container">
                <h2>Bandwidth Received (MB)</h2>
                <canvas id="bandwidthRecvChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        const chartOptions = {
            type: 'line',
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { title: { display: true, text: 'Time', color: '#fff' }, ticks: { color: '#ccc' } },
                    y: { beginAtZero: true, title: { display: true, color: '#fff' }, ticks: { color: '#ccc' } }
                },
                plugins: { legend: { labels: { color: '#fff' } } },
                animation: { duration: 500, easing: 'easeInOutQuad' }
            }
        };

        const cpuChart = new Chart(document.getElementById('cpuChart'), {
            ...chartOptions,
            data: { labels: [], datasets: [{ label: 'CPU', data: [], borderColor: '#ff3b30', fill: false }] }
        });
        const ramChart = new Chart(document.getElementById('ramChart'), {
            ...chartOptions,
            data: { labels: [], datasets: [{ label: 'RAM', data: [], borderColor: '#007aff', fill: false }] }
        });
        const diskChart = new Chart(document.getElementById('diskChart'), {
            ...chartOptions,
            data: { labels: [], datasets: [{ label: 'Disk', data: [], borderColor: '#34c759', fill: false }] }
        });
        const bandwidthSentChart = new Chart(document.getElementById('bandwidthSentChart'), {
            ...chartOptions,
            data: { labels: [], datasets: [{ label: 'Sent', data: [], borderColor: '#af52de', fill: false }] }
        });
        const bandwidthRecvChart = new Chart(document.getElementById('bandwidthRecvChart'), {
            ...chartOptions,
            data: { labels: [], datasets: [{ label: 'Received', data: [], borderColor: '#ff9500', fill: false }] }
        });

        // Bandwidth tracking (simplified, total only)
        let lastSent = 0, lastRecv = 0;
        let dailySent = 0, dailyRecv = 0;

        const ws = new WebSocket('wss://media.mehub.in/server-stats');
        ws.onmessage = (event) => {
            const stats = JSON.parse(event.data);
            const time = new Date().toLocaleTimeString();

            // Calculate daily bandwidth (difference from last reading)
            if (lastSent > 0) {
                dailySent += (stats.bandwidth_sent_total - lastSent);
                dailyRecv += (stats.bandwidth_recv_total - lastRecv);
            }
            lastSent = stats.bandwidth_sent_total;
            lastRecv = stats.bandwidth_recv_total;

            // Update Digital Stats
            document.getElementById('cpuValue').textContent = stats.cpu.toFixed(1);
            document.getElementById('cpuDetails').textContent = `${stats.cpu_count} CPUs @ ${stats.cpu_speed.toFixed(2)} GHz (${stats.cpu_model})`;
            document.getElementById('ramValue').textContent = `${stats.ram_used.toFixed(1)} / ${stats.ram_total.toFixed(1)}`;
            document.getElementById('ramDetails').textContent = `${stats.ram.toFixed(1)}% Used`;
            document.getElementById('diskValue').textContent = `${stats.disk_used.toFixed(1)} / ${stats.disk_total.toFixed(1)}`;
            document.getElementById('diskDetails').textContent = `${stats.disk.toFixed(1)}% Used`;
            document.getElementById('bandwidthSentValue').textContent = dailySent.toFixed(1);
            document.getElementById('bandwidthSentDetails').textContent = `Total: ${stats.bandwidth_sent_total.toFixed(1)} MB`;
            document.getElementById('bandwidthRecvValue').textContent = dailyRecv.toFixed(1);
            document.getElementById('bandwidthRecvDetails').textContent = `Total: ${stats.bandwidth_recv_total.toFixed(1)} MB`;

            // Uptime in days, hours, minutes, seconds
            const uptime = stats.uptime;
            const days = Math.floor(uptime / 86400);
            const hours = Math.floor((uptime % 86400) / 3600);
            const minutes = Math.floor((uptime % 3600) / 60);
            const seconds = Math.floor(uptime % 60);
            document.getElementById('uptimeValue').textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;

            // Update Charts
            [cpuChart, ramChart, diskChart, bandwidthSentChart, bandwidthRecvChart].forEach((chart, index) => {
                chart.data.labels.push(time);
                chart.data.datasets[0].data.push(
                    index === 0 ? stats.cpu :
                    index === 1 ? stats.ram :
                    index === 2 ? stats.disk :
                    index === 3 ? stats.bandwidth_sent_total :
                    stats.bandwidth_recv_total
                );
                if (chart.data.labels.length > 20) {
                    chart.data.labels.shift();
                    chart.data.datasets[0].data.shift();
                }
                chart.update();
            });
        };
        ws.onerror = (error) => console.error('WebSocket error:', error);

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const content = document.getElementById('content');
            sidebar.classList.toggle('active');
            content.classList.toggle('shifted');
        }
    </script>
</body>
</html>